package org.gravel.support.parser;

/*
	This file is automatically generated. See FX.TService.TService class>>generateWorkspaces
	(C) CosmoCows B.V.
*/

import java.math.BigDecimal;
import java.math.BigInteger;
import org.gravel.support.jvm.NonLocalReturn;
import org.gravel.support.parser.Node;
import org.gravel.support.parser.Node.Node_Factory;
import java.util.Map;
import org.gravel.support.parser.Reference;
import org.gravel.support.parser.ClassDescriptionNode;
import org.gravel.support.parser.NamespaceNode;
import java.util.HashMap;
import org.gravel.support.parser.NodeVisitor;
import org.gravel.support.parser.Diff;
import org.gravel.support.parser.ClassNode;
import org.gravel.support.parser.SystemDiff;
import org.gravel.support.parser.AbsoluteReference;
import org.gravel.support.parser.SourcePosition;

public class SystemNode extends Node implements Cloneable {

	public static SystemNode_Factory factory = new SystemNode_Factory();

	Map<Reference, ClassDescriptionNode> _classDescriptionNodes;

	Map<Reference, NamespaceNode> _namespaceNodes;

	public static class SystemNode_Factory extends Node_Factory {

		public SystemNode basicNew() {
			SystemNode newInstance = new SystemNode();
			newInstance.initialize();
			return newInstance;
		}

		public SystemNode classDescriptionNodes_namespaceNodes_(final Map<Reference, ClassDescriptionNode> _aDictionary, final Map<Reference, NamespaceNode> _aDictionary2) {
			return this.basicNew().initializeClassDescriptionNodes_namespaceNodes_(_aDictionary, _aDictionary2);
		}

		public SystemNode empty() {
			return this.classDescriptionNodes_namespaceNodes_(new java.util.HashMap<Reference, ClassDescriptionNode>(), new java.util.HashMap<Reference, NamespaceNode>());
		}
	}

	static public SystemNode _classDescriptionNodes_namespaceNodes_(Object receiver, final Map<Reference, ClassDescriptionNode> _aDictionary, final Map<Reference, NamespaceNode> _aDictionary2) {
		return factory.classDescriptionNodes_namespaceNodes_(_aDictionary, _aDictionary2);
	}

	static public SystemNode _empty(Object receiver) {
		return factory.empty();
	}

	@Override
	public <X> X accept_(final NodeVisitor<X> _visitor) {
		return _visitor.visitSystemNode_(this);
	}

	@Override
	public SystemNode allNodesDo_(final org.gravel.support.jvm.Block1<Object, Node> _aBlock) {
		this.nodesDo_(new org.gravel.support.jvm.Block1<Object, Node>() {

			@Override
			public Object value_(final Node _each) {
				return _each.withAllNodesDo_(_aBlock);
			}
		});
		return this;
	}

	@Override
	public SystemNode allNodesDo_pruneWhere_(final org.gravel.support.jvm.Block1<Object, Node> _aBlock, final org.gravel.support.jvm.Block1<Boolean, Node> _pruneBlock) {
		this.nodesDo_(new org.gravel.support.jvm.Block1<Object, Node>() {

			@Override
			public Object value_(final Node _each) {
				if (!_pruneBlock.value_(_each)) {
					return _each.withAllNodesDo_pruneWhere_(_aBlock, _pruneBlock);
				}
				return SystemNode.this;
			}
		});
		return this;
	}

	public SystemNode applyDiff_(final Diff _aDiff) {
		return _aDiff.applyOnSystemNode_(this);
	}

	public Map<Reference, ClassDescriptionNode> classDescriptionNodes() {
		return _classDescriptionNodes;
	}

	public ClassDescriptionNode classNodeAt_(final Reference _aReference) {
		return _classDescriptionNodes.get(_aReference);
	}

	public Map<Reference, ClassNode> classNodes() {
		final Map<Reference, ClassNode> _dict;
		_dict = new java.util.HashMap<Reference, ClassNode>();
		for (final ClassDescriptionNode _each : _classDescriptionNodes.values()) {
			if (_each.isClassNode()) {
				final ClassNode _cn;
				_cn = ((ClassNode) _each);
				_dict.put(_each.reference(), _cn);
			}
		}
		return _dict;
	}

	public SystemNode copy() {
		try {
			SystemNode _temp1 = (SystemNode) this.clone();
			_temp1.postCopy();
			return _temp1;
		} catch (CloneNotSupportedException e) {
			throw new RuntimeException(e);
		}
	}

	public SystemDiff diffTo_(final SystemNode _aSystemNode) {
		final Diff[] _diff;
		_diff = new Diff[1];
		_diff[0] = EmptyDiff.factory.basicNew();
		org.gravel.support.jvm.DictionaryExtensions.syncWith(this.classNodes(), _aSystemNode.classNodes(), new org.gravel.support.jvm.Block2<Object, ClassNode, ClassNode>() {

			@Override
			public Object value_value_(final ClassNode _old, final ClassNode _new) {
				return _diff[0] = _diff[0].withDiff_(_old.diffTo_(_new));
			}
		}, new org.gravel.support.jvm.Block1<Object, ClassNode>() {

			@Override
			public Object value_(final ClassNode _classNode) {
				final Diff _oDiff;
				_oDiff = _diff[0];
				_diff[0] = _oDiff.withAddClassDiffForClassNode_(_classNode);
				return org.gravel.support.jvm.ObjectExtensions.assert_(SystemNode.this, org.gravel.support.jvm.IntegerExtensions.equals_(_diff[0].classDiffsSize(), _oDiff.classDiffsSize() + 1));
			}
		}, new org.gravel.support.jvm.Block1<Object, ClassNode>() {

			@Override
			public Object value_(final ClassNode _classNode) {
				return _diff[0] = _diff[0].withRemoveClassDiffForClassNode_(_classNode);
			}
		});
		return SystemDiff.factory.diff_namespaces_(_diff[0], _aSystemNode.namespaceNodes());
	}

	public SystemNode_Factory factory() {
		return factory;
	}

	public SystemNode flattenTraits() {
		final Map<Reference, ClassDescriptionNode> _nonTraits;
		_nonTraits = org.gravel.support.jvm.DictionaryExtensions.reject_(_classDescriptionNodes, new org.gravel.support.jvm.Predicate1<ClassDescriptionNode>() {

			@Override
			public boolean value_(final ClassDescriptionNode _each) {
				return _each.isTrait();
			}
		});
		return SystemNode.factory.classDescriptionNodes_namespaceNodes_(org.gravel.support.jvm.DictionaryExtensions.collect_(_nonTraits, ((org.gravel.support.jvm.Block1<ClassDescriptionNode, ClassDescriptionNode>) (new org.gravel.support.jvm.Block1<ClassDescriptionNode, ClassDescriptionNode>() {

			@Override
			public ClassDescriptionNode value_(final ClassDescriptionNode _each) {
				return (ClassDescriptionNode) _each.flattenTraitsIn_(SystemNode.this);
			}
		}))), _namespaceNodes);
	}

	public SystemNode initializeClassDescriptionNodes_namespaceNodes_(final Map<Reference, ClassDescriptionNode> _aDictionary, final Map<Reference, NamespaceNode> _aDictionary2) {
		_classDescriptionNodes = _aDictionary;
		_namespaceNodes = _aDictionary2;
		this.initialize();
		return this;
	}

	@Override
	public SystemNode localVarNamesDo_(final org.gravel.support.jvm.Block1<Object, String> _aBlock) {
		return this;
	}

	public NamespaceNode namespaceNodeAt_(final AbsoluteReference _aReference) {
		return this.namespaceNodeAt_ifAbsent_(_aReference, ((org.gravel.support.jvm.Block0<NamespaceNode>) (new org.gravel.support.jvm.Block0<NamespaceNode>() {

			@Override
			public NamespaceNode value() {
				throw new RuntimeException("Can\'t find namespace: " + _aReference.toString());
			}
		})));
	}

	public NamespaceNode namespaceNodeAt_ifAbsent_(final AbsoluteReference _aReference, final org.gravel.support.jvm.Block0<NamespaceNode> _aBlock) {
		return org.gravel.support.jvm.DictionaryExtensions.at_ifAbsent_(_namespaceNodes, _aReference, _aBlock);
	}

	public Map<Reference, NamespaceNode> namespaceNodes() {
		return _namespaceNodes;
	}

	@Override
	public SystemNode nodesDo_(final org.gravel.support.jvm.Block1<Object, Node> _aBlock) {
		for (final ClassDescriptionNode _temp1 : _classDescriptionNodes.values()) {
			_aBlock.value_(_temp1);
		}
		for (final NamespaceNode _temp2 : _namespaceNodes.values()) {
			_aBlock.value_(_temp2);
		}
		return this;
	}

	@Override
	public SystemNode prettySourceOn_(final StringBuilder _aStream) {
		SourcePrinter.factory.on_(_aStream).visit_(this);
		return this;
	}

	@Override
	public SystemNode printOn_(final StringBuilder _aStream) {
		final String _title;
		_title = this.factory().toString();
		_aStream.append(org.gravel.support.jvm.CharacterExtensions.isVowel(_title.charAt(0)) ? "an " : "a ");
		_aStream.append(_title);
		_aStream.append('[');
		this.sourceOn_(_aStream);
		_aStream.append(']');
		return this;
	}

	public SystemNode pvtSetNamespaceNodes_(final Map<Reference, NamespaceNode> _aDictionary) {
		_namespaceNodes = _aDictionary;
		return this;
	}

	@Override
	public SystemNode pvtSetSourcePosition_(final SourcePosition _aSourcePosition) {
		_sourcePosition = _aSourcePosition;
		return this;
	}

	@Override
	public SystemNode sourceOn_(final StringBuilder _aStream) {
		return this;
	}

	@Override
	public SystemNode withAllNodesDo_(final org.gravel.support.jvm.Block1<Object, Node> _aBlock) {
		_aBlock.value_(this);
		this.allNodesDo_(_aBlock);
		return this;
	}

	@Override
	public SystemNode withAllNodesDo_pruneWhere_(final org.gravel.support.jvm.Block1<Object, Node> _aBlock, final org.gravel.support.jvm.Block1<Boolean, Node> _pruneBlock) {
		_aBlock.value_(this);
		this.allNodesDo_pruneWhere_(_aBlock, _pruneBlock);
		return this;
	}

	public SystemNode withClassDescriptionNode_(final ClassDescriptionNode _aClassDescriptionNode) {
		final AbsoluteReference _namespace;
		_namespace = _aClassDescriptionNode.reference().namespace();
		return this.factory().classDescriptionNodes_namespaceNodes_(org.gravel.support.jvm.DictionaryExtensions.copyAt_put_(_classDescriptionNodes, _aClassDescriptionNode.reference(), _aClassDescriptionNode), org.gravel.support.jvm.DictionaryExtensions.copyAt_ifAbsentPut_(_namespaceNodes, _namespace, ((org.gravel.support.jvm.Block0<NamespaceNode>) (new org.gravel.support.jvm.Block0<NamespaceNode>() {

			@Override
			public NamespaceNode value() {
				return (NamespaceNode) NamespaceNode.factory.for_(_namespace);
			}
		}))));
	}

	public SystemNode withNamespaceNodes_(final Map<Reference, NamespaceNode> _aDictionary) {
		return this.copy().pvtSetNamespaceNodes_(_aDictionary);
	}

	@Override
	public SystemNode withSourcePosition_(final SourcePosition _aSourcePosition) {
		if (_sourcePosition == _aSourcePosition) {
			return SystemNode.this;
		}
		return this.copy().pvtSetSourcePosition_(_aSourcePosition);
	}
}
